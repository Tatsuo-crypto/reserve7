# トラブルシューティングガイド

## 問題1: 新規会員登録ができない

### 症状
管理画面から新規会員を登録しようとすると失敗する

### 確認手順
1. ブラウザの開発者ツール（F12キー）を開く
2. Consoleタブを確認
3. Networkタブで`/api/admin/members`へのPOSTリクエストを確認
4. エラーメッセージを確認

### よくある原因と対処法

#### 1. 店舗情報が取得できない
**症状**: 「店舗情報の読み込みに失敗しました」というエラー
**原因**: Supabaseとの接続問題、または店舗データが未登録
**対処法**:
- Supabase Dashboardで`stores`テーブルを確認
- 少なくとも1つの店舗が登録されているか確認
- 環境変数`SUPABASE_SERVICE_ROLE_KEY`が正しく設定されているか確認

#### 2. メールアドレスが重複している
**症状**: 「このメールアドレスは既に登録されています」というエラー
**原因**: 同じメールアドレスの会員が既に存在
**対処法**:
- 別のメールアドレスを使用
- 既存の会員を検索して、ステータスを確認

#### 3. 必須フィールドが未入力
**症状**: 「名前とメールアドレスは必須です」というエラー
**原因**: 姓、名、またはメールアドレスが空欄
**対処法**:
- すべての必須フィールドを入力

## 問題2: 会員専用URLでパスワードを求められる

### 症状
会員がスマホのSafariで会員専用URL（`/client/[token]`）にアクセスすると、パスワード入力画面が表示される

### 原因
この問題はVercelのデプロイメント保護が有効になっている可能性が高いです。

### 解決方法

#### Vercel側の設定確認（推奨）

1. **Vercelダッシュボードにアクセス**
   - https://vercel.com/dashboard
   - `reserve7`プロジェクトを選択

2. **Settings → Deployment Protection を確認**
   - 「Vercel Authentication」が有効になっている場合、無効にする
   - または、特定のパスを除外する設定を追加

3. **除外設定（Protection Bypass for Automation）**
   - 以下のパスを除外リストに追加:
     ```
     /client/*
     /api/auth/token
     /api/client/*
     ```

#### ブラウザ側の対処法（一時的）

**Safari（iPhone/iPad）の場合**:
1. Safari の設定を開く
2. 「履歴とWebサイトデータを消去」をタップ
3. アプリを再起動
4. 会員専用URLに再度アクセス

**Chrome（Android）の場合**:
1. Chrome の設定を開く
2. 「プライバシーとセキュリティ」→「閲覧履歴データの削除」
3. 「Cookie とサイトデータ」と「キャッシュされた画像とファイル」を選択
4. 「データを削除」をタップ

### 確認方法

1. **開発者ツールで確認**（PC）:
   - F12キーで開発者ツールを開く
   - Networkタブを確認
   - `/api/auth/token`リクエストのステータスコードを確認
   - 401エラー: トークンが無効
   - 403エラー: アカウントが無効化されている
   - 200 OK: 認証成功（パスワード問題ではない）

2. **シークレットモードでテスト**:
   - シークレット/プライベートブラウジングモードで会員URLを開く
   - パスワードを求められなければ、ブラウザキャッシュの問題

## その他のよくある問題

### 予約が表示されない
**対処法**:
- Supabaseで`reservations`テーブルを確認
- `client_id`が会員のIDと一致しているか確認
- `calendar_id`が正しい店舗のものか確認

### 体重・スクワット記録が表示されない
**対処法**:
- Supabaseで`weight_records`、`squat_records`テーブルを確認
- `user_id`が会員のIDと一致しているか確認

## サポート

問題が解決しない場合は、以下の情報を含めて報告してください：
- エラーメッセージの全文
- ブラウザの種類とバージョン
- 再現手順
- ブラウザコンソールのエラーログ（開発者ツールのConsoleタブ）
