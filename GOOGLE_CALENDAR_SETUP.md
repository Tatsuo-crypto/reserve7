# Google Calendar 連動設定ガイド

Reserve7システムでGoogleカレンダー連動を有効にするための設定手順です。

## 前提条件

- Googleアカウントを持っている
- Google Cloud Consoleにアクセスできる
- 管理者権限でReserve7システムを操作できる

## 設定手順

### 1. Google Cloud Projectの作成

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. 新しいプロジェクトを作成（例：`reserve7-calendar`）
3. プロジェクトを選択

### 2. Google Calendar APIの有効化

1. 左側メニューから「APIとサービス」→「ライブラリ」
2. 「Google Calendar API」を検索
3. 「有効にする」をクリック

### 3. サービスアカウントの作成

1. 左側メニューから「APIとサービス」→「認証情報」
2. 「認証情報を作成」→「サービスアカウント」
3. サービスアカウント名を入力（例：`reserve7-calendar-service`）
4. 「作成して続行」をクリック
5. ロールは設定不要（「完了」をクリック）

### 4. サービスアカウントキーの生成

1. 作成したサービスアカウントをクリック
2. 「キー」タブを選択
3. 「鍵を追加」→「新しい鍵を作成」
4. 「JSON」を選択して「作成」
5. ダウンロードされたJSONファイルを保存

### 5. Googleカレンダーの設定

1. [Google Calendar](https://calendar.google.com/) にアクセス
2. 予約用のカレンダーを作成（または既存のカレンダーを使用）
3. カレンダーの設定から「カレンダーの統合」を選択
4. 「カレンダーID」をコピー（例：`primary` または `xxx@group.calendar.google.com`）
5. 「特定のユーザーとの共有」でサービスアカウントのメールアドレスを追加
6. 権限を「予定の変更権限」に設定

### 6. 環境変数の設定

`.env.local` ファイルに以下を追加：

```bash
# Google Calendar Integration
GOOGLE_CALENDAR_ID=your_calendar_id_here
GOOGLE_SERVICE_ACCOUNT_KEY={"type":"service_account","project_id":"your_project_id",...}
```

**重要：** `GOOGLE_SERVICE_ACCOUNT_KEY` には、ダウンロードしたJSONファイルの内容を1行の文字列として設定してください。

### 7. 動作確認

1. Reserve7システムを再起動
2. 管理者アカウントでログイン
3. 新規予約を作成
4. Googleカレンダーに予約が反映されることを確認

## トラブルシューティング

### カレンダーイベントが作成されない

1. サービスアカウントがカレンダーに正しく共有されているか確認
2. カレンダーIDが正しいか確認
3. サービスアカウントキーのJSONが正しく設定されているか確認
4. Google Calendar APIが有効になっているか確認

### 認証エラーが発生する

1. サービスアカウントキーのJSONファイルが破損していないか確認
2. 環境変数の設定が正しいか確認
3. プロジェクトでGoogle Calendar APIが有効になっているか確認

### 権限エラーが発生する

1. サービスアカウントにカレンダーの「予定の変更権限」が付与されているか確認
2. カレンダーの共有設定を再確認

## セキュリティ注意事項

- サービスアカウントキーは機密情報です。Gitリポジトリにコミットしないでください
- `.env.local` ファイルは `.gitignore` に含まれていることを確認してください
- 本番環境では環境変数を安全に管理してください

## 機能の詳細

### 自動作成される予約イベント

- **タイトル**: `[予約タイトル] - [クライアント名]`
- **説明**: クライアント情報とメモ
- **参加者**: クライアントのメールアドレス
- **リマインダー**: 24時間前（メール）、30分前（ポップアップ）
- **タイムゾーン**: Asia/Tokyo

### 通知機能

- 予約作成時にクライアントに自動でメール通知が送信されます
- カレンダーイベントの変更時も通知されます

## サポート

設定に関する質問や問題が発生した場合は、システム管理者にお問い合わせください。
